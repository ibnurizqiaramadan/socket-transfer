function appendServerIp(e){const t=document.createElement("p");t.textContent=e,t.setAttribute("id",`server-${e.replace(/\./g,"")}`),t.style.setProperty("color","red"),serverListContainer.append(t)}function pingServer(){pingInterval=setInterval(()=>{serverList.forEach(e=>{socket.emit("ping",{ip:e.ip,time:+new Date})})},500)}function loadServerList(){socket.emit("getAllRooms"),pingServer()}const socketUrl=document.querySelector('meta[name="socket-url"]').getAttribute("content");let serverList=[];const serverListContainer=document.getElementById("server-list"),btnUpload=document.getElementById("btn-upload"),socket=io(socketUrl);let pingInterval;btnUpload.addEventListener("click",()=>{const e=document.getElementById("file"),t=document.getElementById("path"),n=document.getElementById("ip"),o={name:e.files[0].name,size:e.files[0].size,ip:n.value,path:t.value};socket.emit("upload",{metaData:o,file:e.files[0]},e=>{console.log(e)})}),socket.on("connect",()=>{console.log(`Socket connected to ${socketUrl}`),clearInterval(pingInterval),loadServerList()}),socket.on("sendAllRooms",e=>{serverList=e,serverListContainer.innerHTML="",e.forEach(e=>{appendServerIp(e.ip)})}),socket.on("device-disconnected",e=>{let t=document.getElementById(`server-${e.ip.replace(/\./g,"")}`);t.style.setProperty("color","red"),t.innerHTML=`${e.ip}`}),socket.on("device-connected",e=>{serverList.push(e),appendServerIp(e)}),socket.on("serverResponded",e=>{let t=Math.floor((e.time-e.pingTime)/100),n=document.getElementById(`server-${e.ip.replace(/\./g,"")}`);n.style.setProperty("color","green"),n.innerHTML=`${e.ip} - ${t}ms`}),socket.on("uploadFailed",e=>{console.log(e)});